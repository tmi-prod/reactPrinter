import e,{Component as t}from"react";import{UniqueComponentId as i,DomHandler as n,ZIndexUtils as o,classNames as s,ObjectUtils as r}from"primereact/utils";import{CSSTransition as a}from"primereact/csstransition";import{Ripple as l}from"primereact/ripple";import{Portal as c}from"primereact/portal";function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function u(e){if(Array.isArray(e))return d(e)}function p(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(e,t){if(e){if("string"==typeof e)return d(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?d(e,t):void 0}}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?b(e):t}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var x={exports:{}};function w(){}function S(){}S.resetWarningCache=w;x.exports=function(){function e(e,t,i,n,o,s){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==s){var r=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw r.name="Invariant Violation",r}}function t(){return e}e.isRequired=e;var i={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:S,resetWarningCache:w};return i.PropTypes=i,i}();var R=x.exports;function L(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var C=function(d){v(R,t);var y,E,D,x,w,S=(y=R,E=L(),function(){var e,t=z(y);if(E){var i=z(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return k(this,e)});function R(t){var n;return g(this,R),(n=S.call(this,t)).state={id:t.id,maskVisible:t.visible,visible:!1},n.props.onMaximize||(n.state.maximized=t.maximized),n.onClose=n.onClose.bind(b(n)),n.toggleMaximize=n.toggleMaximize.bind(b(n)),n.onDragStart=n.onDragStart.bind(b(n)),n.onResizeStart=n.onResizeStart.bind(b(n)),n.onMaskClick=n.onMaskClick.bind(b(n)),n.onEnter=n.onEnter.bind(b(n)),n.onEntered=n.onEntered.bind(b(n)),n.onExited=n.onExited.bind(b(n)),n.attributeSelector=i(),n.dialogRef=e.createRef(),n}return D=R,(x=[{key:"onClose",value:function(e){this.props.onHide(),e.preventDefault()}},{key:"focus",value:function(){var e=document.activeElement;!(e&&this.dialogRef&&this.dialogRef.current.contains(e))&&this.props.closable&&this.props.showHeader&&this.closeElement.focus()}},{key:"onMaskClick",value:function(e){this.props.dismissableMask&&this.props.modal&&this.mask===e.target&&this.onClose(e)}},{key:"toggleMaximize",value:function(e){var t=!this.maximized;this.props.onMaximize?this.props.onMaximize({originalEvent:e,maximized:t}):this.setState({maximized:t},this.changeScrollOnMaximizable),e.preventDefault()}},{key:"onDragStart",value:function(e){n.hasClass(e.target,"p-dialog-header-icon")||n.hasClass(e.target.parentElement,"p-dialog-header-icon")||this.props.draggable&&(this.dragging=!0,this.lastPageX=e.pageX,this.lastPageY=e.pageY,this.dialogEl.style.margin="0",n.addClass(document.body,"p-unselectable-text"),this.props.onDragStart&&this.props.onDragStart(e))}},{key:"onDrag",value:function(e){if(this.dragging){var t=n.getOuterWidth(this.dialogEl),i=n.getOuterHeight(this.dialogEl),o=e.pageX-this.lastPageX,s=e.pageY-this.lastPageY,r=this.dialogEl.getBoundingClientRect(),a=r.left+o,l=r.top+s,c=n.getViewport();this.dialogEl.style.position="fixed",this.props.keepInViewport?(a>=this.props.minX&&a+t<c.width&&(this.lastPageX=e.pageX,this.dialogEl.style.left=a+"px"),l>=this.props.minY&&l+i<c.height&&(this.lastPageY=e.pageY,this.dialogEl.style.top=l+"px")):(this.lastPageX=e.pageX,this.dialogEl.style.left=a+"px",this.lastPageY=e.pageY,this.dialogEl.style.top=l+"px"),this.props.onDrag&&this.props.onDrag(e)}}},{key:"onDragEnd",value:function(e){this.dragging&&(this.dragging=!1,n.removeClass(document.body,"p-unselectable-text"),this.props.onDragEnd&&this.props.onDragEnd(e))}},{key:"onResizeStart",value:function(e){this.props.resizable&&(this.resizing=!0,this.lastPageX=e.pageX,this.lastPageY=e.pageY,n.addClass(document.body,"p-unselectable-text"),this.props.onResizeStart&&this.props.onResizeStart(e))}},{key:"convertToPx",value:function(e,t,i){!i&&(i=n.getViewport());var o=parseInt(e);return/^(\d+|(\.\d+))(\.\d+)?%$/.test(e)?o*(i[t]/100):o}},{key:"onResize",value:function(e){if(this.resizing){var t=e.pageX-this.lastPageX,i=e.pageY-this.lastPageY,o=n.getOuterWidth(this.dialogEl),s=n.getOuterHeight(this.dialogEl),r=this.dialogEl.getBoundingClientRect(),a=n.getViewport(),l=o+t,c=s+i,d=this.convertToPx(this.dialogEl.style.minWidth,"width",a),u=this.convertToPx(this.dialogEl.style.minHeight,"height",a);(!parseInt(this.dialogEl.style.top)||!parseInt(this.dialogEl.style.left))&&(l+=t,c+=i),(!d||l>d)&&r.left+l<a.width&&(this.dialogEl.style.width=l+"px"),(!u||c>u)&&r.top+c<a.height&&(this.dialogEl.style.height=c+"px"),this.lastPageX=e.pageX,this.lastPageY=e.pageY,this.props.onResize&&this.props.onResize(e)}}},{key:"onResizeEnd",value:function(e){this.resizing&&(this.resizing=!1,n.removeClass(document.body,"p-unselectable-text"),this.props.onResizeEnd&&this.props.onResizeEnd(e))}},{key:"resetPosition",value:function(){this.dialogEl.style.position="",this.dialogEl.style.left="",this.dialogEl.style.top="",this.dialogEl.style.margin=""}},{key:"getPositionClass",value:function(){var e=this,t=["center","left","right","top","top-left","top-right","bottom","bottom-left","bottom-right"].find((function(t){return t===e.props.position||t.replace("-","")===e.props.position}));return t?"p-dialog-".concat(t):""}},{key:"maximized",get:function(){return this.props.onMaximize?this.props.maximized:this.state.maximized}},{key:"dialogEl",get:function(){return this.dialogRef.current}},{key:"onEnter",value:function(){this.dialogEl.setAttribute(this.attributeSelector,"")}},{key:"onEntered",value:function(){this.props.onShow&&this.props.onShow(),this.props.focusOnShow&&this.focus(),this.enableDocumentSettings()}},{key:"onExited",value:function(){this.dragging=!1,o.clear(this.mask),this.setState({maskVisible:!1}),this.disableDocumentSettings()}},{key:"enableDocumentSettings",value:function(){this.bindGlobalListeners(),(this.props.blockScroll||this.props.maximizable&&this.maximized)&&n.addClass(document.body,"p-overflow-hidden")}},{key:"disableDocumentSettings",value:function(){this.unbindGlobalListeners(),this.props.modal?document.primeDialogParams&&document.primeDialogParams.some((function(e){return e.hasBlockScroll}))||n.removeClass(document.body,"p-overflow-hidden"):(this.props.blockScroll||this.props.maximizable&&this.maximized)&&n.removeClass(document.body,"p-overflow-hidden")}},{key:"bindGlobalListeners",value:function(){this.props.draggable&&this.bindDocumentDragListener(),this.props.resizable&&this.bindDocumentResizeListeners(),this.props.closeOnEscape&&this.props.closable&&this.bindDocumentKeyDownListener()}},{key:"unbindGlobalListeners",value:function(){this.unbindDocumentDragListener(),this.unbindDocumentResizeListeners(),this.unbindDocumentKeyDownListener()}},{key:"bindDocumentDragListener",value:function(){this.documentDragListener=this.onDrag.bind(this),this.documentDragEndListener=this.onDragEnd.bind(this),window.document.addEventListener("mousemove",this.documentDragListener),window.document.addEventListener("mouseup",this.documentDragEndListener)}},{key:"unbindDocumentDragListener",value:function(){this.documentDragListener&&this.documentDragEndListener&&(window.document.removeEventListener("mousemove",this.documentDragListener),window.document.removeEventListener("mouseup",this.documentDragEndListener),this.documentDragListener=null,this.documentDragEndListener=null)}},{key:"bindDocumentResizeListeners",value:function(){this.documentResizeListener=this.onResize.bind(this),this.documentResizeEndListener=this.onResizeEnd.bind(this),window.document.addEventListener("mousemove",this.documentResizeListener),window.document.addEventListener("mouseup",this.documentResizeEndListener)}},{key:"unbindDocumentResizeListeners",value:function(){this.documentResizeListener&&this.documentResizeEndListener&&(window.document.removeEventListener("mousemove",this.documentResizeListener),window.document.removeEventListener("mouseup",this.documentResizeEndListener),this.documentResizeListener=null,this.documentResizeEndListener=null)}},{key:"bindDocumentKeyDownListener",value:function(){var e=this;this.documentKeyDownListener=function(t){var i=t.currentTarget;if(i&&i.primeDialogParams){var o=i.primeDialogParams,s=o.length,r=o[s-1]?o[s-1].id:void 0;if(r===e.state.id){var a=document.getElementById(r);if(27===t.which)e.onClose(t),t.stopImmediatePropagation(),o.splice(s-1,1);else if(9===t.which){t.preventDefault();var l=n.getFocusableElements(a);if(l&&l.length>0)if(document.activeElement){var c=l.indexOf(document.activeElement);t.shiftKey?-1===c||0===c?l[l.length-1].focus():l[c-1].focus():-1===c||c===l.length-1?l[0].focus():l[c+1].focus()}else l[0].focus()}}}};var t,i={id:this.state.id,hasBlockScroll:this.props.blockScroll};document.primeDialogParams=document.primeDialogParams?[].concat(u(t=document.primeDialogParams)||p(t)||m(t)||h(),[i]):[i],document.addEventListener("keydown",this.documentKeyDownListener)}},{key:"unbindDocumentKeyDownListener",value:function(){var e=this;this.documentKeyDownListener&&(document.removeEventListener("keydown",this.documentKeyDownListener),document.primeDialogParams=document.primeDialogParams&&document.primeDialogParams.filter((function(t){return t.id!==e.state.id})),this.documentKeyDownListener=null)}},{key:"createStyle",value:function(){if(!this.styleElement){this.styleElement=document.createElement("style"),document.head.appendChild(this.styleElement);var e="";for(var t in this.props.breakpoints)e+="\n                    @media screen and (max-width: ".concat(t,") {\n                        .p-dialog[").concat(this.attributeSelector,"] {\n                            width: ").concat(this.props.breakpoints[t]," !important;\n                        }\n                    }\n                ");this.styleElement.innerHTML=e}}},{key:"componentDidMount",value:function(){var e=this;this.state.id||this.setState({id:i()}),this.props.visible&&this.setState({visible:!0},(function(){o.set("modal",e.mask,e.props.baseZIndex)})),this.props.breakpoints&&this.createStyle()}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.visible&&!this.state.maskVisible&&this.setState({maskVisible:!0},(function(){o.set("modal",t.mask,t.props.baseZIndex)})),this.props.visible!==this.state.visible&&this.state.maskVisible&&this.setState({visible:this.props.visible}),e.maximized!==this.props.maximized&&this.props.onMaximize&&this.changeScrollOnMaximizable()}},{key:"changeScrollOnMaximizable",value:function(){this.props.blockScroll||n[this.maximized?"addClass":"removeClass"](document.body,"p-overflow-hidden")}},{key:"componentWillUnmount",value:function(){this.disableDocumentSettings(),this.styleElement&&(document.head.removeChild(this.styleElement),this.styleElement=null),o.clear(this.mask)}},{key:"renderCloseIcon",value:function(){var t=this;return this.props.closable?e.createElement("button",{ref:function(e){return t.closeElement=e},type:"button",className:"p-dialog-header-icon p-dialog-header-close p-link","aria-label":this.props.ariaCloseIconLabel,onClick:this.onClose},e.createElement("span",{className:"p-dialog-header-close-icon pi pi-times"}),e.createElement(l,null)):null}},{key:"renderMaximizeIcon",value:function(){var t=s("p-dialog-header-maximize-icon pi",{"pi-window-maximize":!this.maximized,"pi-window-minimize":this.maximized});return this.props.maximizable?e.createElement("button",{type:"button",className:"p-dialog-header-icon p-dialog-header-maximize p-link",onClick:this.toggleMaximize},e.createElement("span",{className:t}),e.createElement(l,null)):null}},{key:"renderHeader",value:function(){var t=this;if(this.props.showHeader){var i=this.renderCloseIcon(),n=this.renderMaximizeIcon(),o=r.getJSXElement(this.props.icons,this.props),s=r.getJSXElement(this.props.header,this.props);return e.createElement("div",{ref:function(e){return t.headerEl=e},className:"p-dialog-header",onMouseDown:this.onDragStart},e.createElement("div",{id:this.state.id+"_header",className:"p-dialog-title"},s),e.createElement("div",{className:"p-dialog-header-icons"},o,n,i))}return null}},{key:"renderContent",value:function(){var t=this,i=s("p-dialog-content",this.props.contentClassName);return e.createElement("div",{id:this.state.id+"_content",ref:function(e){return t.contentEl=e},className:i,style:this.props.contentStyle},this.props.children)}},{key:"renderFooter",value:function(){var t=this,i=r.getJSXElement(this.props.footer,this.props);return i&&e.createElement("div",{ref:function(e){return t.footerElement=e},className:"p-dialog-footer"},i)}},{key:"renderResizer",value:function(){return this.props.resizable?e.createElement("div",{className:"p-resizable-handle",style:{zIndex:90},onMouseDown:this.onResizeStart}):null}},{key:"renderElement",value:function(){var t=this,i=s("p-dialog p-component",this.props.className,{"p-dialog-rtl":this.props.rtl,"p-dialog-maximized":this.maximized}),n=s("p-dialog-mask",{"p-component-overlay":this.props.modal,"p-dialog-visible":this.state.maskVisible,"p-dialog-draggable":this.props.draggable,"p-dialog-resizable":this.props.resizable},this.props.maskClassName,this.getPositionClass()),o=this.renderHeader(),r=this.renderContent(),l=this.renderFooter(),c=this.renderResizer();return e.createElement("div",{ref:function(e){return t.mask=e},className:n,onClick:this.onMaskClick},e.createElement(a,{nodeRef:this.dialogRef,classNames:"p-dialog",timeout:{enter:"center"===this.props.position?150:300,exit:"center"===this.props.position?150:300},in:this.state.visible,options:this.props.transitionOptions,unmountOnExit:!0,onEnter:this.onEnter,onEntered:this.onEntered,onExited:this.onExited},e.createElement("div",{ref:this.dialogRef,id:this.state.id,className:i,style:this.props.style,role:"dialog","aria-labelledby":this.state.id+"_header","aria-describedby":this.state.id+"_content","aria-modal":this.props.modal},o,r,l,c)))}},{key:"render",value:function(){if(this.state.maskVisible){var t=this.renderElement();return e.createElement(c,{element:t,appendTo:this.props.appendTo,visible:!0})}return null}}])&&f(D.prototype,x),w&&f(D,w),R}();D(C,"defaultProps",{id:null,header:null,footer:null,visible:!1,position:"center",draggable:!0,resizable:!0,modal:!0,onHide:null,onShow:null,contentStyle:null,contentClassName:null,closeOnEscape:!0,dismissableMask:!1,rtl:!1,closable:!0,style:null,className:null,maskClassName:null,showHeader:!0,appendTo:null,baseZIndex:0,maximizable:!1,blockScroll:!1,icons:null,ariaCloseIconLabel:"Close",focusOnShow:!0,minX:0,minY:0,keepInViewport:!0,maximized:!1,breakpoints:null,transitionOptions:null,onMaximize:null,onDragStart:null,onDrag:null,onDragEnd:null,onResizeStart:null,onResize:null,onResizeEnd:null}),D(C,"propTypes",{id:R.string,header:R.any,footer:R.any,visible:R.bool,position:R.string,draggable:R.bool,resizable:R.bool,modal:R.bool,onHide:R.func.isRequired,onShow:R.func,contentStyle:R.object,contentClassName:R.string,closeOnEscape:R.bool,dismissableMask:R.bool,rtl:R.bool,closable:R.bool,style:R.object,className:R.string,maskClassName:R.string,showHeader:R.bool,appendTo:R.oneOfType([R.object,R.string]),baseZIndex:R.number,maximizable:R.bool,blockScroll:R.bool,icons:R.any,ariaCloseIconLabel:R.string,focusOnShow:R.bool,minX:R.number,minY:R.number,keepInViewport:R.bool,maximized:R.bool,breakpoints:R.object,transitionOptions:R.object,onMaximize:R.func,onDragStart:R.func,onDrag:R.func,onDragEnd:R.func,onResizeStart:R.func,onResize:R.func,onResizeEnd:R.func});export{C as Dialog};
