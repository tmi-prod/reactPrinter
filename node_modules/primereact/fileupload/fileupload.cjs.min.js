"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("primereact/button"),n=require("primereact/messages"),o=require("primereact/progressbar"),l=require("primereact/utils"),s=require("primereact/ripple"),a=require("primereact/api");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=i(e);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function u(e){if(Array.isArray(e))return p(e)}function c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?y(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F={exports:{}};function k(){}function B(){}B.resetWarningCache=k;F.exports=function(){function e(e,t,n,o,l,s){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==s){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:B,resetWarningCache:k};return n.PropTypes=n,n}();var w=F.exports;function D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=C(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw s}}}}function C(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function N(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var T=function(i){v(B,e.Component);var p,b,g,O,F,k=(p=B,b=N(),function(){var e,t=E(p);if(b){var n=E(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return S(this,e)});function B(e){var t;return h(this,B),(t=k.call(this,e)).state={files:[],msgs:[],focused:!1},t.choose=t.choose.bind(y(t)),t.upload=t.upload.bind(y(t)),t.clear=t.clear.bind(y(t)),t.onFileSelect=t.onFileSelect.bind(y(t)),t.onDragEnter=t.onDragEnter.bind(y(t)),t.onDragOver=t.onDragOver.bind(y(t)),t.onDragLeave=t.onDragLeave.bind(y(t)),t.onDrop=t.onDrop.bind(y(t)),t.onKeyDown=t.onKeyDown.bind(y(t)),t.onFocus=t.onFocus.bind(y(t)),t.onBlur=t.onBlur.bind(y(t)),t.onSimpleUploaderClick=t.onSimpleUploaderClick.bind(y(t)),t.duplicateIEEvent=!1,t}return g=B,(O=[{key:"hasFiles",value:function(){return this.state.files&&this.state.files.length>0}},{key:"isImage",value:function(e){return/^image\//.test(e.type)}},{key:"chooseDisabled",value:function(){return this.props.disabled||this.props.fileLimit&&this.props.fileLimit<=this.state.files.length+this.uploadedFileCount}},{key:"uploadDisabled",value:function(){return this.props.disabled||!this.hasFiles()}},{key:"cancelDisabled",value:function(){return this.props.disabled||!this.hasFiles()}},{key:"chooseButtonLabel",value:function(){return this.props.chooseLabel||this.props.chooseOptions.label||a.localeOption("choose")}},{key:"uploadButtonLabel",value:function(){return this.props.uploadLabel||this.props.uploadOptions.label||a.localeOption("upload")}},{key:"cancelButtonLabel",value:function(){return this.props.cancelLabel||this.props.cancelOptions.label||a.localeOption("cancel")}},{key:"remove",value:function(e,t){this.clearInputElement();var n,o=u(n=this.state.files)||c(n)||f(n)||d(),l=this.state.files[t];o.splice(t,1),this.setState({files:o}),this.props.onRemove&&this.props.onRemove({originalEvent:e,file:l})}},{key:"clearInputElement",value:function(){this.fileInput&&(this.fileInput.value="")}},{key:"clearIEInput",value:function(){this.fileInput&&(this.duplicateIEEvent=!0,this.fileInput.value="")}},{key:"formatSize",value:function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}},{key:"onFileSelect",value:function(e){var t=this;if("drop"!==e.type&&this.isIE11()&&this.duplicateIEEvent)this.duplicateIEEvent=!1;else{this.setState({msgs:[]}),this.files=this.state.files||[];for(var n=e.dataTransfer?e.dataTransfer.files:e.target.files,o=0;o<n.length;o++){var l=n[o];this.isFileSelected(l)||this.validate(l)&&(this.isImage(l)&&(l.objectURL=window.URL.createObjectURL(l)),this.files.push(l))}this.setState({files:this.files},(function(){t.hasFiles()&&t.props.auto&&t.upload()})),this.props.onSelect&&this.props.onSelect({originalEvent:e,files:n}),"drop"!==e.type&&this.isIE11()?this.clearIEInput():this.clearInputElement(),"basic"===this.props.mode&&this.files.length>0&&(this.fileInput.style.display="none")}}},{key:"isFileSelected",value:function(e){var t,n=D(this.state.files);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.name+o.type+o.size===e.name+e.type+e.size)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"isIE11",value:function(){return!!window.MSInputMethodContext&&!!document.documentMode}},{key:"validate",value:function(e){if(this.props.maxFileSize&&e.size>this.props.maxFileSize){var t={severity:"error",summary:this.props.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:this.props.invalidFileSizeMessageDetail.replace("{0}",this.formatSize(this.props.maxFileSize))};return"advanced"===this.props.mode&&this.messagesUI.show(t),this.props.onValidationFail&&this.props.onValidationFail(e),!1}return!0}},{key:"upload",value:function(){var e=this;if(this.props.customUpload)this.props.fileLimit&&(this.uploadedFileCount+=this.state.files.length),this.props.uploadHandler&&this.props.uploadHandler({files:this.state.files,options:{clear:this.clear,props:this.props}});else{this.setState({msgs:[]});var t=new XMLHttpRequest,n=new FormData;this.props.onBeforeUpload&&this.props.onBeforeUpload({xhr:t,formData:n});var o,l=D(this.state.files);try{for(l.s();!(o=l.n()).done;){var s=o.value;n.append(this.props.name,s,s.name)}}catch(e){l.e(e)}finally{l.f()}t.upload.addEventListener("progress",(function(t){t.lengthComputable&&e.setState({progress:Math.round(100*t.loaded/t.total)},(function(){e.props.onProgress&&e.props.onProgress({originalEvent:t,progress:e.state.progress})}))})),t.onreadystatechange=function(){4===t.readyState&&(e.setState({progress:0}),t.status>=200&&t.status<300?(e.props.fileLimit&&(e.uploadedFileCount+=e.state.files.length),e.props.onUpload&&e.props.onUpload({xhr:t,files:e.state.files})):e.props.onError&&e.props.onError({xhr:t,files:e.state.files}),e.clear())},t.open("POST",this.props.url,!0),this.props.onBeforeSend&&this.props.onBeforeSend({xhr:t,formData:n}),t.withCredentials=this.props.withCredentials,t.send(n)}}},{key:"clear",value:function(){this.setState({files:[]}),this.props.onClear&&this.props.onClear(),this.clearInputElement()}},{key:"choose",value:function(){this.fileInput.click()}},{key:"onFocus",value:function(){this.setState({focused:!0})}},{key:"onBlur",value:function(){this.setState({focused:!1})}},{key:"onKeyDown",value:function(e){13===e.which&&this.choose()}},{key:"onDragEnter",value:function(e){this.props.disabled||(e.stopPropagation(),e.preventDefault())}},{key:"onDragOver",value:function(e){this.props.disabled||(l.DomHandler.addClass(this.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())}},{key:"onDragLeave",value:function(e){this.props.disabled||l.DomHandler.removeClass(this.content,"p-fileupload-highlight")}},{key:"onDrop",value:function(e){if(!this.props.disabled){l.DomHandler.removeClass(this.content,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault();var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(this.props.multiple||t&&1===t.length)&&this.onFileSelect(e)}}},{key:"onSimpleUploaderClick",value:function(){this.hasFiles()?this.upload():this.fileInput.click()}},{key:"renderChooseButton",value:function(){var e=this,t=this.props.chooseOptions,n=t.style,o=t.icon,a=t.iconOnly,i=l.classNames("p-button p-fileupload-choose p-component",{"p-disabled":this.props.disabled,"p-focus":this.state.focused,"p-button-icon-only":a},t.className),p=l.classNames("p-button-icon p-button-icon-left p-clickable",{"pi pi-fw pi-plus":!o},o),u="p-button-label p-clickable",c=a?r.default.createElement("span",{className:u,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):r.default.createElement("span",{className:u},this.chooseButtonLabel());return r.default.createElement("span",{className:i,style:n,onClick:this.choose,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,tabIndex:0},r.default.createElement("input",{ref:function(t){return e.fileInput=t},type:"file",onChange:this.onFileSelect,multiple:this.props.multiple,accept:this.props.accept,disabled:this.chooseDisabled()}),r.default.createElement("span",{className:p}),c,r.default.createElement(s.Ripple,null))}},{key:"renderFile",value:function(e,n){var o=this,s=this.isImage(e)?r.default.createElement("div",null,r.default.createElement("img",{alt:e.name,role:"presentation",src:e.objectURL,width:this.props.previewWidth})):null,a=r.default.createElement("div",{className:"p-fileupload-filename"},e.name),i=r.default.createElement("div",null,this.formatSize(e.size)),p=r.default.createElement("div",null,r.default.createElement(t.Button,{type:"button",icon:"pi pi-times",onClick:function(e){return o.remove(e,n)}})),u=r.default.createElement(r.default.Fragment,null,s,a,i,p);if(this.props.itemTemplate){var c={onRemove:function(e){return o.remove(e,n)},previewElement:s,fileNameElement:a,sizeElement:i,removeElement:p,formatSize:this.formatSize(e.size),element:u,props:this.props};u=l.ObjectUtils.getJSXElement(this.props.itemTemplate,e,c)}return r.default.createElement("div",{className:"p-fileupload-row",key:e.name+e.type+e.size},u)}},{key:"renderFiles",value:function(){var e=this;return r.default.createElement("div",{className:"p-fileupload-files"},this.state.files.map((function(t,n){return e.renderFile(t,n)})))}},{key:"renderEmptyContent",value:function(){return this.props.emptyTemplate&&!this.hasFiles()?l.ObjectUtils.getJSXElement(this.props.emptyTemplate,this.props):null}},{key:"renderProgressBarContent",value:function(){return this.props.progressBarTemplate?l.ObjectUtils.getJSXElement(this.props.progressBarTemplate,this.props):r.default.createElement(o.ProgressBar,{value:this.state.progress,showValue:!1})}},{key:"renderAdvanced",value:function(){var e,o,s,a,i=this,p=l.classNames("p-fileupload p-fileupload-advanced p-component",this.props.className),u=l.classNames("p-fileupload-buttonbar",this.props.headerClassName),c=l.classNames("p-fileupload-content",this.props.contentClassName),f=this.renderChooseButton(),d=this.renderEmptyContent();if(!this.props.auto){var h=this.props.uploadOptions,m=this.props.cancelOptions,y=h.iconOnly?"":this.uploadButtonLabel(),b=m.iconOnly?"":this.cancelButtonLabel();e=r.default.createElement(t.Button,{type:"button",label:y,icon:h.icon||"pi pi-upload",onClick:this.upload,disabled:this.uploadDisabled(),style:h.style,className:h.className}),o=r.default.createElement(t.Button,{type:"button",label:b,icon:m.icon||"pi pi-times",onClick:this.clear,disabled:this.cancelDisabled(),style:m.style,className:m.className})}this.hasFiles()&&(s=this.renderFiles(),a=this.renderProgressBarContent());var v=r.default.createElement("div",{className:u,style:this.props.headerStyle},f,e,o);return this.props.headerTemplate&&(v=l.ObjectUtils.getJSXElement(this.props.headerTemplate,{className:u,chooseButton:f,uploadButton:e,cancelButton:o,element:v,props:this.props})),r.default.createElement("div",{id:this.props.id,className:p,style:this.props.style},v,r.default.createElement("div",{ref:function(e){i.content=e},className:c,style:this.props.contentStyle,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop},a,r.default.createElement(n.Messages,{ref:function(e){return i.messagesUI=e}}),s,d))}},{key:"renderBasic",value:function(){var e=this,t=this.props.chooseOptions,o=l.classNames("p-fileupload p-fileupload-basic p-component",this.props.className),a=l.classNames("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":this.hasFiles(),"p-disabled":this.props.disabled,"p-focus":this.state.focused},t.className),i=l.classNames("p-button-icon p-button-icon-left pi",{"pi-plus":!t.icon&&(!this.hasFiles()||this.props.auto),"pi-upload":!t.icon&&this.hasFiles()&&!this.props.auto},t.icon),p="p-button-label p-clickable",u=t.iconOnly?r.default.createElement("span",{className:p,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):r.default.createElement("span",{className:p},this.chooseButtonLabel()),c=this.props.auto?u:r.default.createElement("span",{className:p},this.hasFiles()?this.state.files[0].name:u),f=r.default.createElement("span",{className:i});return r.default.createElement("div",{className:o,style:this.props.style},r.default.createElement(n.Messages,{ref:function(t){return e.messagesUI=t}}),r.default.createElement("span",{className:a,style:t.style,onMouseUp:this.onSimpleUploaderClick,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,tabIndex:0},f,c,!this.hasFiles()&&r.default.createElement("input",{ref:function(t){return e.fileInput=t},type:"file",accept:this.props.accept,multiple:this.props.multiple,disabled:this.props.disabled,onChange:this.onFileSelect}),r.default.createElement(s.Ripple,null)))}},{key:"render",value:function(){return"advanced"===this.props.mode?this.renderAdvanced():"basic"===this.props.mode?this.renderBasic():void 0}}])&&m(g.prototype,O),F&&m(g,F),B}();O(T,"defaultProps",{id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,widthCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null}),O(T,"propTypes",{id:w.string,name:w.string,url:w.string,mode:w.string,multiple:w.bool,accept:w.string,disabled:w.bool,auto:w.bool,maxFileSize:w.number,invalidFileSizeMessageSummary:w.string,invalidFileSizeMessageDetail:w.string,style:w.object,className:w.string,widthCredentials:w.bool,previewWidth:w.number,chooseLabel:w.string,uploadLabel:w.string,cancelLabel:w.string,chooseOptions:w.object,uploadOptions:w.object,cancelOptions:w.object,customUpload:w.bool,headerClassName:w.string,headerStyle:w.object,contentClassName:w.string,contentStyle:w.object,headerTemplate:w.any,itemTemplate:w.any,emptyTemplate:w.any,progressBarTemplate:w.any,onBeforeUpload:w.func,onBeforeSend:w.func,onUpload:w.func,onError:w.func,onClear:w.func,onSelect:w.func,onProgress:w.func,onValidationFail:w.func,uploadHandler:w.func,onRemove:w.func}),exports.FileUpload=T;
